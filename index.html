<!DOCTYPE html>

<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô - Service Staff</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  :root {
    --navy: #1a2744;
    --gold: #c9a84c;
    --light: #f5f3ee;
    --border: #c5b99a;
    --text: #2c2c2c;
    --muted: #6b6b6b;
    --white: #ffffff;
    --pass-bg: #e8f4ec;
    --fail-bg: #fdf0f0;
  }

- { box-sizing: border-box; margin: 0; padding: 0; }

body {
font-family: ‚ÄòSarabun‚Äô, sans-serif;
background: #e8e5df;
min-height: 100vh;
color: var(‚Äìtext);
}

/* Toolbar */
.toolbar {
position: fixed;
top: 0; left: 0; right: 0;
background: var(‚Äìnavy);
padding: 12px 24px;
display: flex;
align-items: center;
justify-content: space-between;
z-index: 100;
box-shadow: 0 2px 12px rgba(0,0,0,0.3);
}

.toolbar-title {
font-family: ‚ÄòPrompt‚Äô, sans-serif;
color: var(‚Äìgold);
font-size: 1rem;
font-weight: 500;
letter-spacing: 0.05em;
}

.toolbar-actions {
display: flex;
gap: 10px;
}

.btn {
padding: 8px 20px;
border: none;
border-radius: 4px;
font-family: ‚ÄòSarabun‚Äô, sans-serif;
font-size: 0.875rem;
font-weight: 600;
cursor: pointer;
transition: all 0.2s;
display: flex;
align-items: center;
gap: 6px;
}

.btn-primary {
background: var(‚Äìgold);
color: var(‚Äìnavy);
}
.btn-primary:hover { background: #b8933d; }

.btn-outline {
background: transparent;
color: var(‚Äìgold);
border: 1.5px solid var(‚Äìgold);
}
.btn-outline:hover { background: rgba(201,168,76,0.15); }

/* Page wrapper */
.page-wrapper {
padding: 80px 24px 40px;
display: flex;
flex-direction: column;
align-items: center;
gap: 20px;
}

.form-instructions {
max-width: 794px;
width: 100%;
background: var(‚Äìnavy);
color: var(‚Äìlight);
padding: 12px 20px;
border-radius: 6px;
font-size: 0.9rem;
line-height: 1.6;
text-align: center;
}

/* Document */
#document {
width: 794px;
background: var(‚Äìwhite);
padding: 40px 50px;
box-shadow: 0 4px 30px rgba(0,0,0,0.15);
border-top: 6px solid var(‚Äìnavy);
}

/* Header */
.doc-header {
margin-bottom: 20px;
}

.doc-title {
text-align: center;
font-family: ‚ÄòPrompt‚Äô, sans-serif;
font-size: 1.2rem;
font-weight: 600;
color: var(‚Äìnavy);
border-bottom: 2px solid var(‚Äìgold);
padding-bottom: 8px;
margin-bottom: 16px;
}

/* Info row */
.info-grid {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 10px;
margin-bottom: 14px;
}

.info-field {
display: flex;
flex-direction: column;
gap: 2px;
}

.info-label {
font-size: 0.72rem;
color: var(‚Äìmuted);
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.05em;
}

.info-input {
border: none;
border-bottom: 1.5px solid var(‚Äìborder);
padding: 4px 2px;
font-family: ‚ÄòSarabun‚Äô, sans-serif;
font-size: 0.95rem;
color: var(‚Äìtext);
background: transparent;
width: 100%;
outline: none;
transition: border-color 0.2s;
}

.info-input:focus { border-color: var(‚Äìnavy); }

.period-field {
grid-column: 1 / -1;
display: flex;
align-items: center;
gap: 8px;
}

.period-label {
font-size: 0.85rem;
color: var(‚Äìmuted);
white-space: nowrap;
font-weight: 600;
}

/* Instruction */
.instruction-box {
background: #f0ede6;
border-left: 4px solid var(‚Äìgold);
padding: 10px 14px;
font-size: 0.82rem;
color: var(‚Äìmuted);
margin-bottom: 18px;
border-radius: 0 4px 4px 0;
line-height: 1.6;
}

.instruction-box strong { color: var(‚Äìnavy); }

/* Table */
.eval-table {
width: 100%;
border-collapse: collapse;
margin-bottom: 24px;
font-size: 0.88rem;
}

.eval-table thead tr {
background: var(‚Äìnavy);
color: var(‚Äìwhite);
}

.eval-table thead th {
padding: 10px 12px;
text-align: center;
font-family: ‚ÄòPrompt‚Äô, sans-serif;
font-weight: 500;
font-size: 0.82rem;
letter-spacing: 0.02em;
border: 1px solid #2e3f6e;
}

.eval-table thead th:first-child { text-align: center; width: 48px; }
.eval-table thead th:nth-child(2) { text-align: left; }

.eval-table tbody tr {
border-bottom: 1px solid #e8e2d6;
transition: background 0.15s;
}

.eval-table tbody tr:hover { background: #faf8f4; }
.eval-table tbody tr:nth-child(even) { background: #fdfcf9; }
.eval-table tbody tr:nth-child(even):hover { background: #f5f2ec; }

.eval-table td {
padding: 10px 12px;
vertical-align: middle;
border: 1px solid #e8e2d6;
}

.row-num {
text-align: center;
font-weight: 700;
color: var(‚Äìmuted);
background: #f5f3ee;
}

.criteria-text {
line-height: 1.5;
color: var(‚Äìtext);
}

/* Radio cells */
.radio-cell {
text-align: center;
vertical-align: middle;
}

.radio-group {
display: flex;
justify-content: center;
gap: 0;
}

.radio-option {
display: flex;
flex-direction: column;
align-items: center;
gap: 4px;
cursor: pointer;
padding: 4px 10px;
border-radius: 4px;
transition: background 0.15s;
}

.radio-option input[type=‚Äúradio‚Äù] { display: none; }

.radio-circle {
width: 22px;
height: 22px;
border-radius: 50%;
border: 2px solid var(‚Äìborder);
display: flex;
align-items: center;
justify-content: center;
transition: all 0.2s;
}

.radio-circle::after {
content: ‚Äò‚Äô;
width: 10px;
height: 10px;
border-radius: 50%;
background: transparent;
transition: all 0.2s;
}

input[type=‚Äúradio‚Äù]:checked + .radio-circle {
border-color: var(‚Äìnavy);
}

.pass-option input[type=‚Äúradio‚Äù]:checked + .radio-circle {
border-color: #2d7a4f;
background: #2d7a4f;
}
.pass-option input[type=‚Äúradio‚Äù]:checked + .radio-circle::after {
background: white;
}

.fail-option input[type=‚Äúradio‚Äù]:checked + .radio-circle {
border-color: #c0392b;
background: #c0392b;
}
.fail-option input[type=‚Äúradio‚Äù]:checked + .radio-circle::after {
background: white;
}

.radio-label {
font-size: 0.72rem;
color: var(‚Äìmuted);
font-weight: 600;
}

.pass-option .radio-label { color: #2d7a4f; }
.fail-option .radio-label { color: #c0392b; }

/* Row status highlighting */
.eval-table tr.row-pass td { background: var(‚Äìpass-bg) !important; }
.eval-table tr.row-fail td { background: var(‚Äìfail-bg) !important; }

.remark-input {
border: none;
border-bottom: 1px dashed var(‚Äìborder);
width: 100%;
font-family: ‚ÄòSarabun‚Äô, sans-serif;
font-size: 0.85rem;
color: var(‚Äìtext);
background: transparent;
padding: 2px 4px;
outline: none;
}
.remark-input:focus { border-bottom-color: var(‚Äìnavy); }

/* Summary */
.summary-section {
border: 1.5px solid var(‚Äìborder);
border-radius: 6px;
overflow: hidden;
margin-bottom: 24px;
}

.summary-title {
background: #f5f3ee;
padding: 8px 16px;
font-weight: 700;
font-size: 0.85rem;
color: var(‚Äìnavy);
border-bottom: 1px solid var(‚Äìborder);
font-family: ‚ÄòPrompt‚Äô, sans-serif;
}

.summary-body {
padding: 14px 16px;
display: flex;
flex-direction: column;
gap: 10px;
}

.additional-remark {
width: 100%;
border: 1px solid var(‚Äìborder);
border-radius: 4px;
padding: 8px 10px;
font-family: ‚ÄòSarabun‚Äô, sans-serif;
font-size: 0.88rem;
color: var(‚Äìtext);
resize: vertical;
min-height: 60px;
outline: none;
transition: border-color 0.2s;
}
.additional-remark:focus { border-color: var(‚Äìnavy); }

/* Result radio */
.result-options {
display: flex;
flex-direction: column;
gap: 8px;
margin-top: 6px;
}

.result-option {
display: flex;
align-items: center;
gap: 10px;
cursor: pointer;
padding: 10px 14px;
border-radius: 5px;
border: 1.5px solid var(‚Äìborder);
transition: all 0.2s;
}

.result-option:hover { border-color: var(‚Äìnavy); background: #f8f6f2; }

.result-option input[type=‚Äúradio‚Äù] { display: none; }

.result-check {
width: 20px;
height: 20px;
border-radius: 50%;
border: 2px solid var(‚Äìborder);
display: flex;
align-items: center;
justify-content: center;
flex-shrink: 0;
transition: all 0.2s;
}

.result-check::after {
content: ‚Äò‚Äô;
width: 9px;
height: 9px;
border-radius: 50%;
background: transparent;
transition: all 0.2s;
}

.result-option.selected-fail {
border-color: #c0392b;
background: #fdf0f0;
}
.result-option.selected-fail .result-check {
border-color: #c0392b;
background: #c0392b;
}
.result-option.selected-fail .result-check::after { background: white; }

.result-option.selected-pass {
border-color: #2d7a4f;
background: #e8f4ec;
}
.result-option.selected-pass .result-check {
border-color: #2d7a4f;
background: #2d7a4f;
}
.result-option.selected-pass .result-check::after { background: white; }

.result-text { font-size: 0.9rem; }
.result-text strong { display: block; font-size: 0.82rem; color: var(‚Äìmuted); font-weight: 400; }

/* Signature */
.signature-section {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 30px;
margin-top: 10px;
}

.sig-box {
display: flex;
flex-direction: column;
align-items: center;
gap: 8px;
}

.sig-title {
font-size: 0.82rem;
color: var(‚Äìmuted);
font-weight: 600;
font-family: ‚ÄòPrompt‚Äô, sans-serif;
}

.sig-name-input {
border: none;
border-bottom: 1.5px solid var(‚Äìborder);
text-align: center;
padding: 4px 8px;
font-family: ‚ÄòSarabun‚Äô, sans-serif;
font-size: 0.92rem;
color: var(‚Äìtext);
background: transparent;
outline: none;
width: 100%;
max-width: 200px;
}

.sig-name-input:focus { border-color: var(‚Äìnavy); }

.sig-date {
font-size: 0.78rem;
color: var(‚Äìmuted);
}

/* Score badge */
.score-badge {
position: fixed;
bottom: 24px;
right: 24px;
background: var(‚Äìnavy);
color: var(‚Äìwhite);
padding: 14px 20px;
border-radius: 12px;
box-shadow: 0 4px 20px rgba(0,0,0,0.25);
text-align: center;
min-width: 120px;
z-index: 50;
transition: all 0.3s;
}

.score-number {
font-family: ‚ÄòPrompt‚Äô, sans-serif;
font-size: 2rem;
font-weight: 600;
color: var(‚Äìgold);
line-height: 1;
}

.score-label {
font-size: 0.72rem;
color: #aaa;
margin-top: 2px;
}

.score-bar {
width: 100%;
height: 4px;
background: rgba(255,255,255,0.15);
border-radius: 2px;
margin-top: 8px;
overflow: hidden;
}

.score-fill {
height: 100%;
background: var(‚Äìgold);
border-radius: 2px;
transition: width 0.4s ease;
}

/* PDF mode */
@media print {
.toolbar, .score-badge, .form-instructions, .btn { display: none !important; }
body { background: white; }
.page-wrapper { padding: 0; }
#document { box-shadow: none; border-top: none; }
}

/* Responsive */
@media (max-width: 850px) {
#document { width: 100%; padding: 24px 16px; }
.info-grid { grid-template-columns: 1fr 1fr; }
}
</style>

</head>
<body>

<!-- Toolbar -->

<div class="toolbar">
  <div class="toolbar-title">üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‚Äî Service Staff</div>
  <div class="toolbar-actions">
    <button class="btn btn-outline" onclick="resetForm()">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <button class="btn btn-primary" onclick="exportPDF()">üìÑ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å / ‡πÅ‡∏ä‡∏£‡πå PDF</button>
  </div>
</div>

<div class="page-wrapper">
  <div class="form-instructions">
    ‚ÑπÔ∏è ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î <strong style="color:var(--gold);">"‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å / ‡πÅ‡∏ä‡∏£‡πå PDF"</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏ä‡∏£‡πå‡∏ú‡πà‡∏≤‡∏ô Line ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏≠‡∏û‡∏≠‡∏∑‡πà‡∏ô‡πÜ
  </div>

  <!-- Document -->

  <div id="document">

```
<div class="doc-header">
  <div class="doc-title">‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</div>
  <div style="text-align:center;font-size:0.85rem;color:var(--muted);margin-top:-6px;margin-bottom:14px;font-family:'Prompt',sans-serif;font-weight:500;">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á : Service Staff</div>
</div>

<!-- Info fields -->
<div class="info-grid">
  <div class="info-field">
    <span class="info-label">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</span>
    <input class="info-input" id="empName" type="text" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" oninput="updatePreview()">
  </div>
  <div class="info-field">
    <span class="info-label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (ID)</span>
    <input class="info-input" id="empId" type="text" placeholder="T0432b">
  </div>
  <div class="info-field">
    <span class="info-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ</span>
    <input class="info-input" id="station" type="text" placeholder="S5">
  </div>
</div>

<div class="instruction-box">
  ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ <strong>‚úì</strong> ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á <strong>"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô"</strong> ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•/‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠
</div>

<!-- Evaluation Table -->
<table class="eval-table" id="evalTable">
  <thead>
    <tr>
      <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
      <th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</th>
      <th colspan="2" style="text-align:center;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</th>
      <th>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• / ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th style="background:#c0392b;color:white;width:70px;">‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</th>
      <th style="background:#2d7a4f;color:white;width:70px;">‡∏ú‡πà‡∏≤‡∏ô</th>
      <th></th>
    </tr>
  </thead>
  <tbody id="evalBody">
  </tbody>
</table>

<!-- Summary -->
<div class="summary-section">
  <div class="summary-title">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</div>
  <div class="summary-body">
    <textarea class="additional-remark" id="additionalRemark" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>

    <div style="font-size:0.85rem;font-weight:700;color:var(--navy);margin-top:4px;">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</div>
    <div class="result-options" id="resultOptions">
      <label class="result-option" id="failOption">
        <input type="radio" name="result" value="fail" onchange="updateResult('fail')">
        <div class="result-check"></div>
        <div class="result-text">
          ‚ùå <strong>‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</strong>
          ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
        </div>
      </label>
      <label class="result-option" id="passOption">
        <input type="radio" name="result" value="pass" onchange="updateResult('pass')">
        <div class="result-check"></div>
        <div class="result-text">
          ‚úÖ <strong>‡∏ú‡πà‡∏≤‡∏ô</strong>
          ‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ
        </div>
      </label>
    </div>
  </div>
</div>

<!-- Signature -->
<div class="signature-section">
  <div class="sig-box">
    <div class="sig-title">‡∏ô‡∏≤‡∏¢‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ</div>
    <input class="sig-name-input" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏≤‡∏¢‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ">
    <div class="sig-date" id="sigDate"></div>
  </div>
  <div class="sig-box">
    <div class="sig-title">‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏≤</div>
    <input class="sig-name-input" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏≤">
    <div class="sig-date" id="sigDate2"></div>
  </div>
</div>
```

  </div><!-- /document -->
</div>

<!-- Score Badge -->

<div class="score-badge" id="scoreBadge">
  <div class="score-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
  <div class="score-number" id="scoreNumber">0/8</div>
  <div class="score-bar"><div class="score-fill" id="scoreFill" style="width:0%"></div></div>
  <div class="score-label" style="margin-top:4px;font-size:0.68rem;" id="scorePercent">0%</div>
</div>

<script>
const criteria = [
  "‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ",
  "‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡∏ú‡∏π‡πâ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£",
  "‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£‡∏´‡πâ‡∏≤‡∏°‡∏Å‡∏¥‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡∏î‡∏∑‡πà‡∏°",
  "‡∏Å‡∏≤‡∏£‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á, ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ)",
  "‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢‡∏á",
  "‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏¥‡∏¢‡∏≤‡∏°‡∏≤‡∏£‡∏¢‡∏≤‡∏ó",
  "‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô",
  "‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢"
];

let scores = new Array(8).fill(null); // null, 'pass', 'fail'

function buildTable() {
  const tbody = document.getElementById('evalBody');
  tbody.innerHTML = '';
  criteria.forEach((c, i) => {
    const tr = document.createElement('tr');
    tr.id = 'row' + i;
    tr.innerHTML = `
      <td class="row-num">${i + 1}</td>
      <td class="criteria-text">${c}</td>
      <td class="radio-cell">
        <label class="radio-option fail-option" onclick="setScore(${i}, 'fail')">
          <input type="radio" name="eval${i}" value="fail">
          <div class="radio-circle"></div>
        </label>
      </td>
      <td class="radio-cell">
        <label class="radio-option pass-option" onclick="setScore(${i}, 'pass')">
          <input type="radio" name="eval${i}" value="pass">
          <div class="radio-circle"></div>
        </label>
      </td>
      <td><input class="remark-input" type="text" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•..."></td>
    `;
    tbody.appendChild(tr);
  });
}

function setScore(idx, val) {
  scores[idx] = val;
  const row = document.getElementById('row' + idx);
  row.className = '';
  if (val === 'pass') row.classList.add('row-pass');
  if (val === 'fail') row.classList.add('row-fail');
  updateScore();
}

function updateScore() {
  const passed = scores.filter(s => s === 'pass').length;
  const answered = scores.filter(s => s !== null).length;
  const pct = answered > 0 ? Math.round((passed / 8) * 100) : 0;
  document.getElementById('scoreNumber').textContent = passed + '/8';
  document.getElementById('scoreFill').style.width = pct + '%';
  document.getElementById('scorePercent').textContent = pct + '%';
}

function updateResult(val) {
  document.getElementById('failOption').className = 'result-option' + (val === 'fail' ? ' selected-fail' : '');
  document.getElementById('passOption').className = 'result-option' + (val === 'pass' ? ' selected-pass' : '');
}

function resetForm() {
  if (!confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) return;
  document.querySelectorAll('input[type="text"], textarea').forEach(el => el.value = '');
  document.querySelectorAll('input[type="radio"]').forEach(el => el.checked = false);
  scores = new Array(8).fill(null);
  document.querySelectorAll('#evalBody tr').forEach(tr => tr.className = '');
  document.getElementById('failOption').className = 'result-option';
  document.getElementById('passOption').className = 'result-option';
  document.getElementById('stationDisplay').textContent = 'S5';
  updateScore();
}

function updatePreview() {}

async function exportPDF() {
  const btn = document.querySelector('.btn-primary');
  btn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF...';
  btn.disabled = true;

  // Hide interactive elements temporarily, show text
  const inputs = document.querySelectorAll('#document input, #document textarea');
  const vals = [];
  inputs.forEach(el => {
    vals.push({ el, val: el.value });
    const span = document.createElement('span');
    span.textContent = el.value || (el.placeholder || '');
    span.style.cssText = el.style.cssText;
    span.className = el.className;
    if (el.tagName === 'TEXTAREA') {
      span.style.display = 'block';
      span.style.whiteSpace = 'pre-wrap';
    }
    el.parentNode.insertBefore(span, el);
    el._span = span;
    el.style.display = 'none';
  });

  try {
    const { jsPDF } = window.jspdf;
    const doc = document.getElementById('document');

    const canvas = await html2canvas(doc, {
      scale: 2,
      useCORS: true,
      backgroundColor: '#ffffff',
      logging: false
    });

    // Restore inputs
    inputs.forEach(el => {
      el.style.display = '';
      if (el._span) el._span.remove();
    });

    const imgData = canvas.toDataURL('image/jpeg', 0.95);
    const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
    const pdfW = pdf.internal.pageSize.getWidth();
    const pdfH = pdf.internal.pageSize.getHeight();
    const imgW = canvas.width;
    const imgH = canvas.height;
    const ratio = pdfW / (imgW / 2 * 0.2646);
    const scaledH = (imgH / 2 * 0.2646) * ratio;

    let posY = 0;
    let remaining = scaledH;
    let page = 0;
    while (remaining > 0) {
      if (page > 0) pdf.addPage();
      const srcY = page * (pdfH / ratio / 0.2646) * 2;
      pdf.addImage(imgData, 'JPEG', 0, -posY, pdfW, scaledH);
      posY += pdfH;
      remaining -= pdfH;
      page++;
    }

    const empName = document.getElementById('empName').value || '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
    const empId = document.getElementById('empId').value || 'ID';
    const filename = `‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô_${empName}_${empId}.pdf`;

    // Try share API first (mobile)
    const blob = pdf.output('blob');
    const file = new File([blob], filename, { type: 'application/pdf' });

    if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
      await navigator.share({
        title: '‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
        text: `‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ${empName}`,
        files: [file]
      });
    } else {
      // Desktop: download
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
      alert('üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF ‡πÅ‡∏•‡πâ‡∏ß!\n\n‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠: ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå PDF ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "‡πÅ‡∏ä‡∏£‡πå" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô Line ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏≠‡∏û‡∏≠‡∏∑‡πà‡∏ô');
    }

  } catch (e) {
    // Restore inputs if error
    inputs.forEach(el => {
      el.style.display = '';
      if (el._span) el._span.remove();
    });
    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
  }

  btn.textContent = 'üìÑ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å / ‡πÅ‡∏ä‡∏£‡πå PDF';
  btn.disabled = false;
}

// Init
buildTable();
updateScore();

// Set today's date
const today = new Date().toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
document.getElementById('sigDate').textContent = today;
document.getElementById('sigDate2').textContent = today;
</script>

</body>
</html>
